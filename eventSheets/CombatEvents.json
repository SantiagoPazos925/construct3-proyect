{
    "is-c3-clipboard-data": true,
    "type": "events",
    "items": [
        {
            "eventType": "include",
            "includeSheet": "GlobalVariables"
        },
        {
            "eventType": "group",
            "disabled": false,
            "title": "Combat System - Optimizado",
            "description": "Sistema de combate automático optimizado entre PlayerCombat y EnemyCombat",
            "isActiveOnStart": true,
            "children": [
                {
                    "eventType": "comment",
                    "text": "=== INICIALIZACIÓN DEL SISTEMA ==="
                },
                {
                    "eventType": "comment",
                    "text": "NOTA: Las variables de velocidad están definidas en GlobalVariables.json"
                },
                {
                    "eventType": "block",
                    "conditions": [
                        {
                            "id": "on-start-of-layout",
                            "objectClass": "System"
                        }
                    ],
                    "actions": [
                        {
                            "type": "comment",
                            "text": "SETEANDO VARIABLES Y TEXTOS GENERALES UI"
                        }
                    ],
                    "children": [
                        {
                            "eventType": "block",
                            "conditions": [],
                            "actions": [
                                {
                                    "id": "set-eventvar-value",
                                    "objectClass": "System",
                                    "parameters": {
                                        "variable": "combatState",
                                        "value": "\"playerTurn\""
                                    }
                                },
                                {
                                    "id": "set-eventvar-value",
                                    "objectClass": "System",
                                    "parameters": {
                                        "variable": "playerAttack",
                                        "value": "25"
                                    }
                                },
                                {
                                    "id": "set-instvar-value",
                                    "objectClass": "PlayerCombat",
                                    "parameters": {
                                        "instance-variable": "PhysicalDamage",
                                        "value": "PlayerCombat.Strength * 3 + PlayerCombat.Agility * 1"
                                    }
                                },
                                {
                                    "id": "set-instvar-value",
                                    "objectClass": "PlayerCombat",
                                    "parameters": {
                                        "instance-variable": "MaxHealth",
                                        "value": "PlayerCombat.Vitality* 20 + PlayerCombat.Strength* 5"
                                    }
                                },
                                {
                                    "id": "set-instvar-value",
                                    "objectClass": "PlayerCombat",
                                    "parameters": {
                                        "instance-variable": "DodgeChance",
                                        "value": "PlayerCombat.Agility* 1.5 + PlayerCombat.Speed* 0.8"
                                    }
                                },
                                {
                                    "id": "set-instvar-value",
                                    "objectClass": "PlayerCombat",
                                    "parameters": {
                                        "instance-variable": "CriticalChance",
                                        "value": "PlayerCombat.Agility* 1.2 + PlayerCombat.Speed* 0.4"
                                    }
                                },
                                {
                                    "id": "set-instvar-value",
                                    "objectClass": "PlayerCombat",
                                    "parameters": {
                                        "instance-variable": "DamageReduction",
                                        "value": "PlayerCombat.Defense * 1.5 + PlayerCombat.Vitality * 0.8"
                                    }
                                },
                                {
                                    "id": "set-instvar-value",
                                    "objectClass": "PlayerCombat",
                                    "parameters": {
                                        "instance-variable": "CriticalDamage",
                                        "value": "EnemyCombat.Strength* 4 + EnemyCombat.Agility* 1.5"
                                    }
                                },
                                {
                                    "id": "set-instvar-value",
                                    "objectClass": "EnemyCombat",
                                    "parameters": {
                                        "instance-variable": "PhysicalDamage",
                                        "value": "EnemyCombat.Strength * 3 + EnemyCombat.Agility * 1"
                                    }
                                },
                                {
                                    "id": "set-instvar-value",
                                    "objectClass": "EnemyCombat",
                                    "parameters": {
                                        "instance-variable": "MaxHealth",
                                        "value": "EnemyCombat.Vitality* 20 + EnemyCombat.Strength* 5"
                                    }
                                },
                                {
                                    "id": "set-instvar-value",
                                    "objectClass": "EnemyCombat",
                                    "parameters": {
                                        "instance-variable": "DodgeChance",
                                        "value": "EnemyCombat.Agility* 1.5 + EnemyCombat.Speed* 0.8"
                                    }
                                },
                                {
                                    "id": "set-instvar-value",
                                    "objectClass": "EnemyCombat",
                                    "parameters": {
                                        "instance-variable": "CriticalChance",
                                        "value": "EnemyCombat.Agility* 1.2 + EnemyCombat.Speed* 0.4"
                                    }
                                },
                                {
                                    "id": "set-instvar-value",
                                    "objectClass": "EnemyCombat",
                                    "parameters": {
                                        "instance-variable": "CriticalDamage",
                                        "value": "EnemyCombat.Strength* 4 + EnemyCombat.Agility* 1.5"
                                    }
                                },
                                {
                                    "id": "set-instvar-value",
                                    "objectClass": "EnemyCombat",
                                    "parameters": {
                                        "instance-variable": "DamageReduction",
                                        "value": "EnemyCombat.Defense * 1.5 + EnemyCombat.Vitality * 0.8"
                                    }
                                },
                                {
                                    "id": "set-eventvar-value",
                                    "objectClass": "System",
                                    "parameters": {
                                        "variable": "currentHP",
                                        "value": "PlayerCombat.MaxHealth"
                                    }
                                },
                                {
                                    "id": "set-eventvar-value",
                                    "objectClass": "System",
                                    "parameters": {
                                        "variable": "currentEnemyHP",
                                        "value": "EnemyCombat.MaxHealth"
                                    }
                                },
                                {
                                    "id": "set-eventvar-value",
                                    "objectClass": "System",
                                    "parameters": {
                                        "variable": "enemyAttack",
                                        "value": "25"
                                    }
                                },
                                {
                                    "id": "set-boolean-eventvar",
                                    "objectClass": "System",
                                    "parameters": {
                                        "variable": "isAttacking",
                                        "value": "false"
                                    }
                                },
                                {
                                    "id": "set-eventvar-value",
                                    "objectClass": "System",
                                    "parameters": {
                                        "variable": "attackCooldown",
                                        "value": "0"
                                    }
                                },
                                {
                                    "id": "set-eventvar-value",
                                    "objectClass": "System",
                                    "parameters": {
                                        "variable": "originalPlayerX",
                                        "value": "PlayerCombat.X"
                                    }
                                },
                                {
                                    "id": "set-eventvar-value",
                                    "objectClass": "System",
                                    "parameters": {
                                        "variable": "originalPlayerY",
                                        "value": "PlayerCombat.Y"
                                    }
                                },
                                {
                                    "id": "set-text",
                                    "objectClass": "PlayerHealth",
                                    "parameters": {
                                        "text": "PlayerHealth.Text = \"Player HP: \" & currentHP"
                                    }
                                },
                                {
                                    "id": "set-text",
                                    "objectClass": "EnemyHealth",
                                    "parameters": {
                                        "text": "EnemyHealth.Text = \"Enemy HP: \" & currentEnemyHP"
                                    }
                                },
                                {
                                    "id": "set-eventvar-value",
                                    "objectClass": "System",
                                    "parameters": {
                                        "variable": "originalEnemyX",
                                        "value": "EnemyCombat.X"
                                    }
                                },
                                {
                                    "id": "set-eventvar-value",
                                    "objectClass": "System",
                                    "parameters": {
                                        "variable": "originalEnemyY",
                                        "value": "EnemyCombat.Y"
                                    }
                                },
                                {
                                    "id": "set-text",
                                    "objectClass": "PlayerHealth",
                                    "parameters": {
                                        "text": "\"HP: \" & max(0, currentHP)"
                                    }
                                },
                                {
                                    "id": "set-text",
                                    "objectClass": "EnemyHealth",
                                    "parameters": {
                                        "text": "\"HP: \" & max(0, currentEnemyHP)"
                                    }
                                },
                                {
                                    "id": "tween-value",
                                    "objectClass": "PlayerHealthBar",
                                    "behaviorType": "Tween",
                                    "parameters": {
                                        "tags": "\"PlayerHealthBarTween\"",
                                        "start-value": "PlayerHealthBar.width",
                                        "end-value": "PlayerHealthBar.Width ",
                                        "time": "0.5",
                                        "ease": "easeoutsine",
                                        "destroy-on-complete": "no",
                                        "loop": "no",
                                        "ping-pong": "no",
                                        "repeat-count": "1"
                                    }
                                },
                                {
                                    "id": "tween-value",
                                    "objectClass": "EnemyHealthBar",
                                    "behaviorType": "Tween",
                                    "parameters": {
                                        "tags": "\"EnemyHealthBarTween\"",
                                        "start-value": "EnemyHealthBar.width",
                                        "end-value": "EnemyHealthBar.width",
                                        "time": "0.5",
                                        "ease": "easeoutsine",
                                        "destroy-on-complete": "no",
                                        "loop": "no",
                                        "ping-pong": "no",
                                        "repeat-count": "1"
                                    }
                                },
                                {
                                    "id": "play",
                                    "objectClass": "Audio",
                                    "parameters": {
                                        "audio-file": "Dungeon",
                                        "loop": "looping",
                                        "volume": "-100",
                                        "stereo-pan": "0",
                                        "tag-optional": "\"Battle\""
                                    }
                                },
                                {
                                    "id": "set-mirrored",
                                    "objectClass": "EnemyCombat",
                                    "parameters": {
                                        "state": "mirrored"
                                    }
                                },
                                {
                                    "type": "script",
                                    "language": "javascript",
                                    "script": [
                                        "console.log('🎮 SISTEMA DE COMBATE OPTIMIZADO INICIADO')",
                                        "console.log('Estado:', runtime.globalVars.combatState, ', PlayerHP:', runtime.globalVars.playerHP, ', EnemyHP:', runtime.globalVars.enemyHP)"
                                    ]
                                },
                                {
                                    "type": "script",
                                    "language": "javascript",
                                    "script": [
                                        "console.log('  - VARIABLES', runtime.objects.PlayerCombat.getFirstInstance().instVars)"
                                    ]
                                }
                            ]
                        }
                    ]
                },
                {
                    "eventType": "block",
                    "conditions": [
                        {
                            "id": "on-start-of-layout",
                            "objectClass": "System"
                        }
                    ],
                    "actions": [
                        {
                            "type": "comment",
                            "text": "DEBUGGER"
                        }
                    ],
                    "children": [
                        {
                            "eventType": "block",
                            "conditions": [],
                            "actions": [
                                {
                                    "type": "script",
                                    "language": "javascript",
                                    "script": [
                                        "console.log('🎯 ESTADÍSTICAS DEL JUGADOR:')",
                                        "console.log('  - Fuerza:', runtime.objects.PlayerCombat.getFirstInstance().instVars.Strength)",
                                        "console.log('  - Vitalidad:', runtime.objects.PlayerCombat.getFirstInstance().instVars.Vitality)",
                                        "console.log('  - Agilidad:', runtime.objects.PlayerCombat.getFirstInstance().instVars.Agility)",
                                        "console.log('  - Velocidad:', runtime.objects.PlayerCombat.getFirstInstance().instVars.Speed)",
                                        "console.log('  - Defensa:', runtime.objects.PlayerCombat.getFirstInstance().instVars.Defense)",
                                        "console.log('  - Daño Físico:', runtime.objects.PlayerCombat.getFirstInstance().instVars.PhysicalDamage)",
                                        "console.log('  - Velocidad de Ataque:', runtime.objects.PlayerCombat.getFirstInstance().instVars.AttackSpeed)",
                                        "console.log('  - Probabilidad de Crítico:', runtime.objects.PlayerCombat.getFirstInstance().instVars.CriticalChance + '%')",
                                        "console.log('  - Daño Crítico:', runtime.objects.PlayerCombat.getFirstInstance().instVars.CriticalDamage + '%')",
                                        "console.log('  - Probabilidad de Esquivar:', runtime.objects.PlayerCombat.getFirstInstance().instVars.DodgeChance + '%')",
                                        "console.log('  - Reducción de Daño:', runtime.objects.PlayerCombat.getFirstInstance().instVars.DamageReduction)",
                                        "console.log('🎯 ESTADÍSTICAS DEL ENEMIGO:')",
                                        "console.log('  - Fuerza:', runtime.objects.EnemyCombat.getFirstInstance().instVars.Strength)",
                                        "console.log('  - Vitalidad:', runtime.objects.EnemyCombat.getFirstInstance().instVars.Vitality)",
                                        "console.log('  - Agilidad:', runtime.objects.EnemyCombat.getFirstInstance().instVars.Agility)",
                                        "console.log('  - Velocidad:', runtime.objects.EnemyCombat.getFirstInstance().instVars.Speed)",
                                        "console.log('  - Defensa:', runtime.objects.EnemyCombat.getFirstInstance().instVars.Defense)",
                                        "console.log('  - Daño Físico:', runtime.objects.EnemyCombat.getFirstInstance().instVars.PhysicalDamage)",
                                        "console.log('  - Velocidad de Ataque:', runtime.objects.EnemyCombat.getFirstInstance().instVars.AttackSpeed)",
                                        "console.log('  - Probabilidad de Crítico:', runtime.objects.EnemyCombat.getFirstInstance().instVars.CriticalChance + '%')",
                                        "console.log('  - Daño Crítico:', runtime.objects.EnemyCombat.getFirstInstance().instVars.CriticalDamage + '%')",
                                        "console.log('  - Probabilidad de Esquivar:', runtime.objects.EnemyCombat.getFirstInstance().instVars.DodgeChance + '%')",
                                        "console.log('  - Reducción de Daño:', runtime.objects.EnemyCombat.getFirstInstance().instVars.DamageReduction)"
                                    ]
                                }
                            ]
                        }
                    ]
                },
                {
                    "eventType": "comment",
                    "text": "=== SISTEMA DE COOLDOWN OPTIMIZADO ==="
                },
                {
                    "eventType": "block",
                    "conditions": [
                        {
                            "id": "every-tick",
                            "objectClass": "System"
                        },
                        {
                            "id": "compare-eventvar",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "attackCooldown",
                                "comparison": 1,
                                "value": "0"
                            }
                        }
                    ],
                    "actions": [
                        {
                            "id": "subtract-from-eventvar",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "attackCooldown",
                                "value": "1"
                            }
                        }
                    ]
                },
                {
                    "eventType": "comment",
                    "text": "=== INICIAR ATAQUE CUANDO COOLDOWN TERMINA ==="
                },
                {
                    "eventType": "block",
                    "conditions": [
                        {
                            "id": "compare-eventvar",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "attackCooldown",
                                "comparison": 0,
                                "value": "0"
                            }
                        },
                        {
                            "id": "compare-boolean-eventvar",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "isAttacking"
                            },
                            "isInverted": true
                        },
                        {
                            "id": "trigger-once-while-true",
                            "objectClass": "System"
                        }
                    ],
                    "actions": [
                        {
                            "id": "set-eventvar-value",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "attackCooldown",
                                "value": "120"
                            }
                        },
                        {
                            "id": "set-boolean-eventvar",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "isAttacking",
                                "value": "true"
                            }
                        },
                        {
                            "type": "script",
                            "language": "javascript",
                            "script": [
                                "console.log('⚡ ATAQUE INICIADO - Estado:', runtime.globalVars.combatState)"
                            ]
                        }
                    ]
                },
                {
                    "eventType": "comment",
                    "text": "=== SISTEMA DE TURNOS CONSOLIDADO ==="
                },
                {
                    "eventType": "block",
                    "conditions": [
                        {
                            "id": "compare-eventvar",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "combatState",
                                "comparison": 0,
                                "value": "\"playerTurn\""
                            }
                        },
                        {
                            "id": "compare-boolean-eventvar",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "isAttacking"
                            }
                        },
                        {
                            "id": "trigger-once-while-true",
                            "objectClass": "System"
                        }
                    ],
                    "actions": [
                        {
                            "id": "set-eventvar-value",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "combatState",
                                "value": "\"playerAttacking\""
                            }
                        },
                        {
                            "id": "set-eventvar-value",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "targetX",
                                "value": "EnemyCombat.X"
                            }
                        },
                        {
                            "id": "set-eventvar-value",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "targetY",
                                "value": "EnemyCombat.Y"
                            }
                        },
                        {
                            "type": "script",
                            "language": "javascript",
                            "script": [
                                "console.log('👤 TURNO DEL JUGADOR - Objetivo:', runtime.globalVars.targetX, ',', runtime.globalVars.targetY)"
                            ]
                        }
                    ]
                },
                {
                    "eventType": "block",
                    "conditions": [
                        {
                            "id": "compare-eventvar",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "combatState",
                                "comparison": 0,
                                "value": "\"enemyTurn\""
                            }
                        },
                        {
                            "id": "compare-boolean-eventvar",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "isAttacking"
                            }
                        },
                        {
                            "id": "trigger-once-while-true",
                            "objectClass": "System"
                        }
                    ],
                    "actions": [
                        {
                            "id": "set-eventvar-value",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "combatState",
                                "value": "\"enemyAttacking\""
                            }
                        },
                        {
                            "id": "set-eventvar-value",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "targetX",
                                "value": "PlayerCombat.X"
                            }
                        },
                        {
                            "id": "set-eventvar-value",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "targetY",
                                "value": "PlayerCombat.Y"
                            }
                        },
                        {
                            "type": "script",
                            "language": "javascript",
                            "script": [
                                "console.log('👹 TURNO DEL ENEMIGO - Objetivo:', runtime.globalVars.targetX, ',', runtime.globalVars.targetY)"
                            ]
                        }
                    ]
                },
                {
                    "eventType": "comment",
                    "text": "=== SISTEMA DE ANIMACIONES DEL PLAYERCOMBAT ==="
                },
                {
                    "eventType": "block",
                    "conditions": [
                        {
                            "id": "on-start-of-layout",
                            "objectClass": "System"
                        }
                    ],
                    "actions": [
                        {
                            "id": "set-animation",
                            "objectClass": "PlayerCombat",
                            "parameters": {
                                "animation": "\"Idle\"",
                                "from": "beginning"
                            }
                        }
                    ]
                },
                {
                    "eventType": "block",
                    "conditions": [
                        {
                            "id": "compare-eventvar",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "combatState",
                                "comparison": 0,
                                "value": "\"playerAttacking\""
                            }
                        },
                        {
                            "id": "trigger-once-while-true",
                            "objectClass": "System"
                        }
                    ],
                    "actions": [
                        {
                            "id": "set-animation",
                            "objectClass": "PlayerCombat",
                            "parameters": {
                                "animation": "\"Travel\"",
                                "from": "beginning"
                            }
                        }
                    ]
                },
                {
                    "eventType": "block",
                    "conditions": [
                        {
                            "id": "compare-eventvar",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "combatState",
                                "comparison": 0,
                                "value": "\"playerReturning\""
                            }
                        },
                        {
                            "id": "trigger-once-while-true",
                            "objectClass": "System"
                        }
                    ],
                    "actions": [
                        {
                            "id": "set-animation",
                            "objectClass": "PlayerCombat",
                            "parameters": {
                                "animation": "\"Backward\"",
                                "from": "beginning"
                            }
                        }
                    ]
                },
                {
                    "eventType": "block",
                    "conditions": [
                        {
                            "id": "compare-eventvar",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "combatState",
                                "comparison": 0,
                                "value": "\"playerTurn\""
                            }
                        },
                        {
                            "id": "trigger-once-while-true",
                            "objectClass": "System"
                        }
                    ],
                    "actions": [
                        {
                            "id": "set-animation",
                            "objectClass": "PlayerCombat",
                            "parameters": {
                                "animation": "\"Idle\"",
                                "from": "beginning"
                            }
                        }
                    ]
                },
                {
                    "eventType": "block",
                    "conditions": [
                        {
                            "id": "compare-eventvar",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "combatState",
                                "comparison": 0,
                                "value": "\"turnPauseToEnemy\""
                            }
                        },
                        {
                            "id": "trigger-once-while-true",
                            "objectClass": "System"
                        }
                    ],
                    "actions": [
                        {
                            "id": "set-animation",
                            "objectClass": "PlayerCombat",
                            "parameters": {
                                "animation": "\"Idle\"",
                                "from": "beginning"
                            }
                        }
                    ]
                },
                {
                    "eventType": "block",
                    "conditions": [
                        {
                            "id": "compare-eventvar",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "combatState",
                                "comparison": 0,
                                "value": "\"turnPauseToPlayer\""
                            }
                        },
                        {
                            "id": "trigger-once-while-true",
                            "objectClass": "System"
                        }
                    ],
                    "actions": [
                        {
                            "id": "set-animation",
                            "objectClass": "PlayerCombat",
                            "parameters": {
                                "animation": "\"Idle\"",
                                "from": "beginning"
                            }
                        }
                    ]
                },
                {
                    "eventType": "comment",
                    "text": "=== SISTEMA DE ANIMACIONES DEL ENEMYCOMBAT ==="
                },
                {
                    "eventType": "block",
                    "conditions": [
                        {
                            "id": "on-start-of-layout",
                            "objectClass": "System"
                        }
                    ],
                    "actions": [
                        {
                            "id": "set-animation",
                            "objectClass": "EnemyCombat",
                            "parameters": {
                                "animation": "\"Idle\"",
                                "from": "beginning"
                            }
                        }
                    ]
                },
                {
                    "eventType": "block",
                    "conditions": [
                        {
                            "id": "compare-eventvar",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "combatState",
                                "comparison": 0,
                                "value": "\"enemyAttacking\""
                            }
                        },
                        {
                            "id": "trigger-once-while-true",
                            "objectClass": "System"
                        }
                    ],
                    "actions": [
                        {
                            "id": "set-animation",
                            "objectClass": "EnemyCombat",
                            "parameters": {
                                "animation": "\"Travel\"",
                                "from": "beginning"
                            }
                        }
                    ]
                },
                {
                    "eventType": "block",
                    "conditions": [
                        {
                            "id": "compare-eventvar",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "combatState",
                                "comparison": 0,
                                "value": "\"enemyReturning\""
                            }
                        },
                        {
                            "id": "trigger-once-while-true",
                            "objectClass": "System"
                        }
                    ],
                    "actions": [
                        {
                            "id": "set-animation",
                            "objectClass": "EnemyCombat",
                            "parameters": {
                                "animation": "\"Backward\"",
                                "from": "beginning"
                            }
                        }
                    ]
                },
                {
                    "eventType": "block",
                    "conditions": [
                        {
                            "id": "compare-eventvar",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "combatState",
                                "comparison": 0,
                                "value": "\"enemyTurn\""
                            }
                        },
                        {
                            "id": "trigger-once-while-true",
                            "objectClass": "System"
                        }
                    ],
                    "actions": [
                        {
                            "id": "set-animation",
                            "objectClass": "EnemyCombat",
                            "parameters": {
                                "animation": "\"Idle\"",
                                "from": "beginning"
                            }
                        }
                    ]
                },
                {
                    "eventType": "block",
                    "conditions": [
                        {
                            "id": "compare-eventvar",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "combatState",
                                "comparison": 0,
                                "value": "\"turnPauseToEnemy\""
                            }
                        },
                        {
                            "id": "trigger-once-while-true",
                            "objectClass": "System"
                        }
                    ],
                    "actions": [
                        {
                            "id": "set-animation",
                            "objectClass": "EnemyCombat",
                            "parameters": {
                                "animation": "\"Idle\"",
                                "from": "beginning"
                            }
                        }
                    ]
                },
                {
                    "eventType": "block",
                    "conditions": [
                        {
                            "id": "compare-eventvar",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "combatState",
                                "comparison": 0,
                                "value": "\"turnPauseToPlayer\""
                            }
                        },
                        {
                            "id": "trigger-once-while-true",
                            "objectClass": "System"
                        }
                    ],
                    "actions": [
                        {
                            "id": "set-animation",
                            "objectClass": "EnemyCombat",
                            "parameters": {
                                "animation": "\"Idle\"",
                                "from": "beginning"
                            }
                        }
                    ]
                },
                {
                    "eventType": "comment",
                    "text": "=== SISTEMA DE MOVIMIENTO CONSOLIDADO ==="
                },
                {
                    "eventType": "block",
                    "conditions": [
                        {
                            "id": "every-tick",
                            "objectClass": "System"
                        },
                        {
                            "id": "compare-eventvar",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "combatState",
                                "comparison": 0,
                                "value": "\"playerAttacking\""
                            }
                        }
                    ],
                    "actions": [
                        {
                            "id": "set-position",
                            "objectClass": "PlayerCombat",
                            "parameters": {
                                "x": "PlayerCombat.X + ( targetX- PlayerCombat.X ) * moveSpeed",
                                "y": "PlayerCombat.Y + (targetY - PlayerCombat.Y) * moveSpeed"
                            }
                        },
                        {
                            "id": "move-to-top",
                            "objectClass": "PlayerCombat"
                        }
                    ]
                },
                {
                    "eventType": "block",
                    "conditions": [
                        {
                            "id": "every-tick",
                            "objectClass": "System"
                        },
                        {
                            "id": "compare-eventvar",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "combatState",
                                "comparison": 0,
                                "value": "\"enemyAttacking\""
                            }
                        }
                    ],
                    "actions": [
                        {
                            "id": "set-position",
                            "objectClass": "EnemyCombat",
                            "parameters": {
                                "x": "EnemyCombat.X + (targetX - EnemyCombat.X) * moveSpeed",
                                "y": "EnemyCombat.Y + (targetY - EnemyCombat.Y) * moveSpeed"
                            }
                        },
                        {
                            "id": "move-to-top",
                            "objectClass": "EnemyCombat"
                        }
                    ]
                },
                {
                    "eventType": "block",
                    "conditions": [
                        {
                            "id": "every-tick",
                            "objectClass": "System"
                        },
                        {
                            "id": "compare-eventvar",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "combatState",
                                "comparison": 0,
                                "value": "\"playerReturning\""
                            }
                        }
                    ],
                    "actions": [
                        {
                            "id": "set-position",
                            "objectClass": "PlayerCombat",
                            "parameters": {
                                "x": "PlayerCombat.X + (originalPlayerX - PlayerCombat.X) * moveSpeed",
                                "y": "PlayerCombat.Y + (originalPlayerY - PlayerCombat.Y) * moveSpeed"
                            }
                        }
                    ]
                },
                {
                    "eventType": "block",
                    "conditions": [
                        {
                            "id": "every-tick",
                            "objectClass": "System"
                        },
                        {
                            "id": "compare-eventvar",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "combatState",
                                "comparison": 0,
                                "value": "\"enemyReturning\""
                            }
                        }
                    ],
                    "actions": [
                        {
                            "id": "set-position",
                            "objectClass": "EnemyCombat",
                            "parameters": {
                                "x": "EnemyCombat.X + (originalEnemyX - EnemyCombat.X) * moveSpeed",
                                "y": "EnemyCombat.Y + (originalEnemyY - EnemyCombat.Y) * moveSpeed"
                            }
                        }
                    ]
                },
                {
                    "eventType": "comment",
                    "text": "=== SISTEMA DE ATAQUE CONSOLIDADO ==="
                },
                {
                    "functionName": "setAnimationAttack",
                    "functionDescription": "",
                    "functionCategory": "",
                    "functionReturnType": "none",
                    "functionCopyPicked": false,
                    "functionIsAsync": false,
                    "functionParameters": [],
                    "eventType": "function-block",
                    "conditions": [],
                    "actions": [],
                    "children": [
                        {
                            "eventType": "block",
                            "conditions": [
                                {
                                    "id": "compare-boolean-eventvar",
                                    "objectClass": "System",
                                    "parameters": {
                                        "variable": "isCriticalHit"
                                    }
                                }
                            ],
                            "actions": [
                                {
                                    "id": "set-animation",
                                    "objectClass": "PlayerCombat",
                                    "parameters": {
                                        "animation": "\"CriticalAttack\"",
                                        "from": "beginning"
                                    }
                                },
                                {
                                    "type": "script",
                                    "language": "javascript",
                                    "script": [
                                        "console.log('golpe critico')"
                                    ]
                                }
                            ]
                        },
                        {
                            "eventType": "block",
                            "conditions": [
                                {
                                    "id": "else",
                                    "objectClass": "System"
                                }
                            ],
                            "actions": [
                                {
                                    "id": "set-animation",
                                    "objectClass": "PlayerCombat",
                                    "parameters": {
                                        "animation": "\"Attack\"",
                                        "from": "beginning"
                                    }
                                },
                                {
                                    "type": "script",
                                    "language": "javascript",
                                    "script": [
                                        "console.log('golpe normal')"
                                    ]
                                }
                            ]
                        }
                    ]
                },
                {
                    "functionName": "setAnimationAttackEnemy",
                    "functionDescription": "",
                    "functionCategory": "",
                    "functionReturnType": "none",
                    "functionCopyPicked": false,
                    "functionIsAsync": false,
                    "functionParameters": [],
                    "eventType": "function-block",
                    "conditions": [],
                    "actions": [],
                    "children": [
                        {
                            "eventType": "block",
                            "conditions": [
                                {
                                    "id": "compare-boolean-eventvar",
                                    "objectClass": "System",
                                    "parameters": {
                                        "variable": "isEnemyCriticalHit"
                                    }
                                }
                            ],
                            "actions": [
                                {
                                    "id": "set-animation",
                                    "objectClass": "EnemyCombat",
                                    "parameters": {
                                        "animation": "\"CriticalAttack\"",
                                        "from": "beginning"
                                    }
                                },
                                {
                                    "type": "script",
                                    "language": "javascript",
                                    "script": [
                                        "console.log('enemigo golpe critico')"
                                    ]
                                }
                            ]
                        },
                        {
                            "eventType": "block",
                            "conditions": [
                                {
                                    "id": "else",
                                    "objectClass": "System"
                                }
                            ],
                            "actions": [
                                {
                                    "id": "set-animation",
                                    "objectClass": "EnemyCombat",
                                    "parameters": {
                                        "animation": "\"Attack\"",
                                        "from": "beginning"
                                    }
                                },
                                {
                                    "type": "script",
                                    "language": "javascript",
                                    "script": [
                                        "console.log('enemigo golpe normal')"
                                    ]
                                }
                            ]
                        }
                    ]
                },
                {
                    "eventType": "comment",
                    "text": "PLAYER ATTACK"
                },
                {
                    "eventType": "block",
                    "conditions": [
                        {
                            "id": "compare-eventvar",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "combatState",
                                "comparison": 0,
                                "value": "\"playerAttacking\""
                            }
                        },
                        {
                            "id": "compare-two-values",
                            "objectClass": "System",
                            "parameters": {
                                "first-value": "distance(PlayerCombat.X, PlayerCombat.Y, targetX, targetY)",
                                "comparison": 2,
                                "second-value": "500"
                            }
                        },
                        {
                            "id": "trigger-once-while-true",
                            "objectClass": "System"
                        }
                    ],
                    "actions": [
                        {
                            "id": "set-eventvar-value",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "randomDodgeValue",
                                "value": "random(0,100)"
                            }
                        },
                        {
                            "id": "set-eventvar-value",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "randomCriticalValue",
                                "value": "random(0,100)"
                            }
                        },
                        {
                            "id": "set-eventvar-value",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "isCriticalHit",
                                "value": "randomCriticalValue <= PlayerCombat.CriticalChance"
                            }
                        },
                        {
                            "callFunction": "setAnimationAttack"
                        },
                        {
                            "id": "wait",
                            "objectClass": "System",
                            "parameters": {
                                "seconds": "0.5",
                                "use-timescale": true
                            }
                        }
                    ],
                    "children": [
                        {
                            "eventType": "block",
                            "conditions": [
                                {
                                    "id": "compare-two-values",
                                    "objectClass": "System",
                                    "parameters": {
                                        "first-value": "randomDodgeValue",
                                        "comparison": 5,
                                        "second-value": "EnemyCombat.DodgeChance"
                                    }
                                }
                            ],
                            "actions": [
                                {
                                    "type": "script",
                                    "language": "javascript",
                                    "script": [
                                        "console.log('golpe certero')"
                                    ]
                                },
                                {
                                    "callFunction": "playerHit",
                                    "parameters": [
                                        "\"Enemy\""
                                    ]
                                },
                                {
                                    "callFunction": "damageText",
                                    "parameters": [
                                        "isCriticalHit ? \"CRÍTICO! -\" & round(max(1, (PlayerCombat.PhysicalDamage * (1 + PlayerCombat.CriticalDamage / 100)) - EnemyCombat.DamageReduction)) : \"-\" & round(max(1, PlayerCombat.PhysicalDamage - EnemyCombat.DamageReduction))"
                                    ]
                                },
                                {
                                    "type": "script",
                                    "language": "javascript",
                                    "script": [
                                        "console.log('💥 JUGADOR ATACA - Daño:', runtime.globalVars.enemyAttack, ', PlayerHP:', runtime.globalVars.playerHP)"
                                    ]
                                }
                            ]
                        },
                        {
                            "eventType": "block",
                            "conditions": [
                                {
                                    "id": "else",
                                    "objectClass": "System"
                                }
                            ],
                            "actions": [
                                {
                                    "id": "set-eventvar-value",
                                    "objectClass": "System",
                                    "parameters": {
                                        "variable": "combatState",
                                        "value": "\"playerReturning\""
                                    }
                                },
                                {
                                    "callFunction": "damageText",
                                    "parameters": [
                                        "\"Esquiva!\""
                                    ]
                                },
                                {
                                    "callFunction": "Dodge",
                                    "parameters": [
                                        "\"Enemy\""
                                    ]
                                },
                                {
                                    "type": "script",
                                    "language": "javascript",
                                    "script": [
                                        "console.log('esquiva')"
                                    ]
                                }
                            ]
                        },
                        {
                            "eventType": "block",
                            "conditions": [],
                            "actions": []
                        }
                    ]
                },
                {
                    "eventType": "comment",
                    "text": "Enemy flashes"
                },
                {
                    "eventType": "block",
                    "conditions": [
                        {
                            "id": "is-playing",
                            "objectClass": "EnemyCombat",
                            "behaviorType": "Tween",
                            "parameters": {
                                "tags": "\"EnemyFlash\""
                            }
                        }
                    ],
                    "actions": [
                        {
                            "id": "set-effect-parameter",
                            "objectClass": "EnemyCombat",
                            "parameters": {
                                "effect": "\"AdjustHSL\"",
                                "parameter-index": "2",
                                "value": "Self.Tween.Value(\"EnemyFlash\")"
                            }
                        }
                    ]
                },
                {
                    "eventType": "comment",
                    "text": "ENEMY ATTACK"
                },
                {
                    "eventType": "block",
                    "conditions": [
                        {
                            "id": "compare-eventvar",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "combatState",
                                "comparison": 0,
                                "value": "\"enemyAttacking\""
                            }
                        },
                        {
                            "id": "compare-two-values",
                            "objectClass": "System",
                            "parameters": {
                                "first-value": "distance(EnemyCombat.X, EnemyCombat.Y, targetX, targetY)",
                                "comparison": 2,
                                "second-value": "500"
                            }
                        },
                        {
                            "id": "trigger-once-while-true",
                            "objectClass": "System"
                        }
                    ],
                    "actions": [
                        {
                            "id": "set-eventvar-value",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "randomDodgeValue",
                                "value": "random(0,100)"
                            }
                        },
                        {
                            "id": "set-eventvar-value",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "randomEnemyCriticalValue",
                                "value": "random(0,100)"
                            }
                        },
                        {
                            "id": "set-eventvar-value",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "isEnemyCriticalHit",
                                "value": "randomEnemyCriticalValue <= EnemyCombat.CriticalChance"
                            }
                        },
                        {
                            "callFunction": "setAnimationAttackEnemy"
                        },
                        {
                            "id": "wait",
                            "objectClass": "System",
                            "parameters": {
                                "seconds": "0.5",
                                "use-timescale": true
                            }
                        }
                    ],
                    "children": [
                        {
                            "eventType": "block",
                            "conditions": [
                                {
                                    "id": "compare-two-values",
                                    "objectClass": "System",
                                    "parameters": {
                                        "first-value": "randomDodgeValue",
                                        "comparison": 5,
                                        "second-value": "PlayerCombat.DodgeChance"
                                    }
                                }
                            ],
                            "actions": [
                                {
                                    "type": "script",
                                    "language": "javascript",
                                    "script": [
                                        "console.log('golpe certero')"
                                    ]
                                },
                                {
                                    "callFunction": "playerHit",
                                    "parameters": [
                                        "\"Player\""
                                    ]
                                },
                                {
                                    "callFunction": "damageText",
                                    "parameters": [
                                        "isEnemyCriticalHit ? \"CRÍTICO! -\" & round(max(1, (EnemyCombat.PhysicalDamage * (1 + EnemyCombat.CriticalDamage / 100)) - PlayerCombat.DamageReduction)) : \"-\" & round(max(1, EnemyCombat.PhysicalDamage - PlayerCombat.DamageReduction))"
                                    ]
                                },
                                {
                                    "type": "script",
                                    "language": "javascript",
                                    "script": [
                                        "console.log('💥 ENEMIGO ATACA - Daño:', runtime.globalVars.enemyAttack, ', PlayerHP:', runtime.globalVars.currentHP)"
                                    ]
                                }
                            ]
                        },
                        {
                            "eventType": "block",
                            "conditions": [
                                {
                                    "id": "else",
                                    "objectClass": "System"
                                }
                            ],
                            "actions": [
                                {
                                    "callFunction": "Dodge",
                                    "parameters": [
                                        "\"Player\""
                                    ]
                                },
                                {
                                    "id": "set-eventvar-value",
                                    "objectClass": "System",
                                    "parameters": {
                                        "variable": "combatState",
                                        "value": "\"enemyReturning\""
                                    }
                                },
                                {
                                    "callFunction": "damageText",
                                    "parameters": [
                                        "\"Esquiva!\""
                                    ]
                                },
                                {
                                    "type": "script",
                                    "language": "javascript",
                                    "script": [
                                        "console.log('esquiva')"
                                    ]
                                }
                            ]
                        }
                    ]
                },
                {
                    "eventType": "comment",
                    "text": "Player flashes"
                },
                {
                    "eventType": "block",
                    "conditions": [
                        {
                            "id": "is-playing",
                            "objectClass": "PlayerCombat",
                            "behaviorType": "Tween",
                            "parameters": {
                                "tags": "\"PlayerFlash\""
                            }
                        }
                    ],
                    "actions": [
                        {
                            "id": "set-effect-parameter",
                            "objectClass": "PlayerCombat",
                            "parameters": {
                                "effect": "\"AdjustHSL\"",
                                "parameter-index": "2",
                                "value": "Self.Tween.Value(\"PlayerFlash\")"
                            }
                        }
                    ]
                },
                {
                    "eventType": "comment",
                    "text": "=== SISTEMA DE BARRAS DE VIDA DINÁMICAS ==="
                },
                {
                    "eventType": "block",
                    "conditions": [
                        {
                            "id": "is-playing",
                            "objectClass": "PlayerHealthBar",
                            "behaviorType": "Tween",
                            "parameters": {
                                "tags": "\"PlayerHealthBarTween\""
                            }
                        }
                    ],
                    "actions": [
                        {
                            "id": "set-width",
                            "objectClass": "PlayerHealthBar",
                            "parameters": {
                                "width": "Self.Tween.Value(\"PlayerHealthBarTween\")"
                            }
                        }
                    ]
                },
                {
                    "eventType": "block",
                    "conditions": [
                        {
                            "id": "is-playing",
                            "objectClass": "EnemyHealthBar",
                            "behaviorType": "Tween",
                            "parameters": {
                                "tags": "\"EnemyHealthBarTween\""
                            }
                        }
                    ],
                    "actions": [
                        {
                            "id": "set-width",
                            "objectClass": "EnemyHealthBar",
                            "parameters": {
                                "width": "Self.Tween.Value(\"EnemyHealthBarTween\")"
                            }
                        }
                    ]
                },
                {
                    "eventType": "comment",
                    "text": "NOTA: Los colores se pueden configurar manualmente en las propiedades del sprite"
                },
                {
                    "eventType": "comment",
                    "text": "=== SISTEMA DE LIMPIEZA DE TEXTO DE DAÑO ==="
                },
                {
                    "eventType": "block",
                    "conditions": [
                        {
                            "id": "is-playing",
                            "objectClass": "Damage",
                            "behaviorType": "Tween",
                            "parameters": {
                                "tags": "\"DamageFade\""
                            }
                        }
                    ],
                    "actions": [
                        {
                            "id": "set-opacity",
                            "objectClass": "Damage",
                            "parameters": {
                                "opacity": "Self.Tween.Value(\"DamageFade\")"
                            }
                        }
                    ]
                },
                {
                    "eventType": "comment",
                    "text": "=== SISTEMA DE CAMBIO DE TURNOS CONSOLIDADO ==="
                },
                {
                    "eventType": "block",
                    "conditions": [
                        {
                            "id": "compare-eventvar",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "combatState",
                                "comparison": 0,
                                "value": "\"playerReturning\""
                            }
                        },
                        {
                            "id": "compare-two-values",
                            "objectClass": "System",
                            "parameters": {
                                "first-value": "distance(PlayerCombat.X, PlayerCombat.Y, originalPlayerX, originalPlayerY)",
                                "comparison": 2,
                                "second-value": "10"
                            }
                        },
                        {
                            "id": "trigger-once-while-true",
                            "objectClass": "System"
                        }
                    ],
                    "actions": [
                        {
                            "id": "set-eventvar-value",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "combatState",
                                "value": "\"turnPauseToEnemy\""
                            }
                        },
                        {
                            "id": "set-eventvar-value",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "turnPauseTimer",
                                "value": "turnDelay"
                            }
                        },
                        {
                            "id": "set-boolean-eventvar",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "isAttacking",
                                "value": "false"
                            }
                        },
                        {
                            "type": "script",
                            "language": "javascript",
                            "script": [
                                "console.log('🔄 CAMBIO DE TURNO - Pausa antes del turno del enemigo. PlayerHP:', runtime.globalVars.currentHP, ', EnemyHP:', runtime.globalVars.currentEnemyHP)"
                            ]
                        }
                    ]
                },
                {
                    "eventType": "block",
                    "conditions": [
                        {
                            "id": "compare-eventvar",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "combatState",
                                "comparison": 0,
                                "value": "\"enemyReturning\""
                            }
                        },
                        {
                            "id": "compare-two-values",
                            "objectClass": "System",
                            "parameters": {
                                "first-value": "distance(EnemyCombat.X, EnemyCombat.Y, originalEnemyX, originalEnemyY)",
                                "comparison": 2,
                                "second-value": "10"
                            }
                        },
                        {
                            "id": "trigger-once-while-true",
                            "objectClass": "System"
                        }
                    ],
                    "actions": [
                        {
                            "id": "set-eventvar-value",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "combatState",
                                "value": "\"turnPauseToPlayer\""
                            }
                        },
                        {
                            "id": "set-eventvar-value",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "turnPauseTimer",
                                "value": "turnDelay"
                            }
                        },
                        {
                            "id": "set-boolean-eventvar",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "isAttacking",
                                "value": "false"
                            }
                        },
                        {
                            "type": "script",
                            "language": "javascript",
                            "script": [
                                "console.log('🔄 CAMBIO DE TURNO - Pausa antes del turno del jugador. PlayerHP:', runtime.globalVars.currentHP, ', EnemyHP:', runtime.globalVars.currentEnemyHP)"
                            ]
                        }
                    ]
                },
                {
                    "eventType": "comment",
                    "text": "=== SISTEMA DE PAUSA ENTRE TURNOS ==="
                },
                {
                    "eventType": "block",
                    "conditions": [
                        {
                            "id": "compare-eventvar",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "combatState",
                                "comparison": 0,
                                "value": "\"turnPauseToEnemy\""
                            }
                        },
                        {
                            "id": "every-tick",
                            "objectClass": "System"
                        }
                    ],
                    "actions": [
                        {
                            "id": "subtract-from-eventvar",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "turnPauseTimer",
                                "value": "1/60"
                            }
                        }
                    ]
                },
                {
                    "eventType": "block",
                    "conditions": [
                        {
                            "id": "compare-eventvar",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "combatState",
                                "comparison": 0,
                                "value": "\"turnPauseToPlayer\""
                            }
                        },
                        {
                            "id": "every-tick",
                            "objectClass": "System"
                        }
                    ],
                    "actions": [
                        {
                            "id": "subtract-from-eventvar",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "turnPauseTimer",
                                "value": "1/60"
                            }
                        }
                    ]
                },
                {
                    "eventType": "block",
                    "conditions": [
                        {
                            "id": "compare-eventvar",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "combatState",
                                "comparison": 0,
                                "value": "\"turnPauseToEnemy\""
                            }
                        },
                        {
                            "id": "compare-eventvar",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "turnPauseTimer",
                                "comparison": 2,
                                "value": "0"
                            }
                        },
                        {
                            "id": "trigger-once-while-true",
                            "objectClass": "System"
                        }
                    ],
                    "actions": [
                        {
                            "id": "set-eventvar-value",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "combatState",
                                "value": "\"enemyTurn\""
                            }
                        },
                        {
                            "type": "script",
                            "language": "javascript",
                            "script": [
                                "console.log('⏰ PAUSA TERMINADA - Turno del enemigo iniciado')"
                            ]
                        }
                    ]
                },
                {
                    "eventType": "block",
                    "conditions": [
                        {
                            "id": "compare-eventvar",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "combatState",
                                "comparison": 0,
                                "value": "\"turnPauseToPlayer\""
                            }
                        },
                        {
                            "id": "compare-eventvar",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "turnPauseTimer",
                                "comparison": 2,
                                "value": "0"
                            }
                        },
                        {
                            "id": "trigger-once-while-true",
                            "objectClass": "System"
                        }
                    ],
                    "actions": [
                        {
                            "id": "set-eventvar-value",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "combatState",
                                "value": "\"playerTurn\""
                            }
                        },
                        {
                            "type": "script",
                            "language": "javascript",
                            "script": [
                                "console.log('⏰ PAUSA TERMINADA - Turno del jugador iniciado')"
                            ]
                        }
                    ]
                },
                {
                    "eventType": "comment",
                    "text": "=== SISTEMA DE REGRESO DESPUÉS DE VICTORIA ==="
                },
                {
                    "eventType": "block",
                    "conditions": [
                        {
                            "id": "compare-eventvar",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "combatState",
                                "comparison": 0,
                                "value": "\"victory\""
                            }
                        },
                        {
                            "id": "compare-two-values",
                            "objectClass": "System",
                            "parameters": {
                                "first-value": "distance(PlayerCombat.X, PlayerCombat.Y, originalPlayerX, originalPlayerY)",
                                "comparison": 1,
                                "second-value": "10"
                            }
                        }
                    ],
                    "actions": [
                        {
                            "id": "set-position",
                            "objectClass": "PlayerCombat",
                            "parameters": {
                                "x": "PlayerCombat.X + (originalPlayerX - PlayerCombat.X) * moveSpeed",
                                "y": "PlayerCombat.Y + (originalPlayerY - PlayerCombat.Y) * moveSpeed"
                            }
                        }
                    ]
                },
                {
                    "eventType": "block",
                    "conditions": [
                        {
                            "id": "compare-eventvar",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "combatState",
                                "comparison": 0,
                                "value": "\"victory\""
                            }
                        },
                        {
                            "id": "compare-two-values",
                            "objectClass": "System",
                            "parameters": {
                                "first-value": "distance(PlayerCombat.X, PlayerCombat.Y, originalPlayerX, originalPlayerY)",
                                "comparison": 2,
                                "second-value": "10"
                            }
                        },
                        {
                            "id": "trigger-once-while-true",
                            "objectClass": "System"
                        }
                    ],
                    "actions": [
                        {
                            "id": "set-animation",
                            "objectClass": "PlayerCombat",
                            "parameters": {
                                "animation": "\"Idle\"",
                                "from": "beginning"
                            }
                        }
                    ]
                },
                {
                    "eventType": "block",
                    "conditions": [
                        {
                            "id": "compare-eventvar",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "combatState",
                                "comparison": 0,
                                "value": "\"defeat\""
                            }
                        },
                        {
                            "id": "compare-two-values",
                            "objectClass": "System",
                            "parameters": {
                                "first-value": "distance(EnemyCombat.X, EnemyCombat.Y, originalEnemyX, originalEnemyY)",
                                "comparison": 1,
                                "second-value": "10"
                            }
                        }
                    ],
                    "actions": [
                        {
                            "id": "set-position",
                            "objectClass": "EnemyCombat",
                            "parameters": {
                                "x": "EnemyCombat.X + (originalEnemyX - EnemyCombat.X) * moveSpeed",
                                "y": "EnemyCombat.Y + (originalEnemyY - EnemyCombat.Y) * moveSpeed"
                            }
                        }
                    ]
                },
                {
                    "eventType": "block",
                    "conditions": [
                        {
                            "id": "compare-eventvar",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "combatState",
                                "comparison": 0,
                                "value": "\"defeat\""
                            }
                        },
                        {
                            "id": "compare-two-values",
                            "objectClass": "System",
                            "parameters": {
                                "first-value": "distance(EnemyCombat.X, EnemyCombat.Y, originalEnemyX, originalEnemyY)",
                                "comparison": 2,
                                "second-value": "10"
                            }
                        },
                        {
                            "id": "trigger-once-while-true",
                            "objectClass": "System"
                        }
                    ],
                    "actions": [
                        {
                            "id": "set-animation",
                            "objectClass": "EnemyCombat",
                            "parameters": {
                                "animation": "\"Idle\"",
                                "from": "beginning"
                            }
                        }
                    ]
                },
                {
                    "eventType": "comment",
                    "text": "=== SISTEMA DE FINALIZACIÓN DE COMBATE ==="
                },
                {
                    "eventType": "block",
                    "conditions": [
                        {
                            "id": "compare-eventvar",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "currentEnemyHP",
                                "comparison": 3,
                                "value": "0"
                            }
                        },
                        {
                            "id": "trigger-once-while-true",
                            "objectClass": "System"
                        }
                    ],
                    "actions": [
                        {
                            "id": "tween-one-property",
                            "objectClass": "EnemyCombat",
                            "behaviorType": "Tween",
                            "parameters": {
                                "tags": "\"EnemyDies\"",
                                "property": "offsetOpacity",
                                "end-value": "0",
                                "time": "1",
                                "ease": "easeinoutsine",
                                "destroy-on-complete": "no",
                                "loop": "no",
                                "ping-pong": "no",
                                "repeat-count": "1"
                            }
                        },
                        {
                            "id": "set-animation",
                            "objectClass": "EnemyCombat",
                            "parameters": {
                                "animation": "\"GroundImpact\"",
                                "from": "beginning"
                            }
                        },
                        {
                            "id": "set-eventvar-value",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "combatState",
                                "value": "\"victory\""
                            }
                        },
                        {
                            "id": "play",
                            "objectClass": "Audio",
                            "parameters": {
                                "audio-file": "Enemy_Destroy",
                                "loop": "not-looping",
                                "volume": "0",
                                "stereo-pan": "0",
                                "tag-optional": "\"Die\""
                            }
                        },
                        {
                            "id": "fade-volume",
                            "objectClass": "Audio",
                            "parameters": {
                                "tag": "\"Battle\"",
                                "db": "-100",
                                "duration": "0",
                                "ending": "stop"
                            }
                        },
                        {
                            "type": "script",
                            "language": "javascript",
                            "script": [
                                "console.log('🏆 VICTORIA DEL JUGADOR - ¡Enemigo derrotado!')"
                            ]
                        },
                        {
                            "id": "fade-volume",
                            "objectClass": "Audio",
                            "parameters": {
                                "tag": "\"Battle\"",
                                "db": "-100",
                                "duration": "0",
                                "ending": "stop"
                            }
                        }
                    ],
                    "children": [
                        {
                            "eventType": "block",
                            "conditions": [
                                {
                                    "id": "on-tweens-finished",
                                    "objectClass": "EnemyCombat",
                                    "behaviorType": "Tween",
                                    "parameters": {
                                        "tags": "\"EnemyDies\""
                                    }
                                }
                            ],
                            "actions": [
                                {
                                    "id": "destroy",
                                    "objectClass": "EnemyCombat"
                                }
                            ]
                        }
                    ]
                },
                {
                    "eventType": "block",
                    "conditions": [
                        {
                            "id": "compare-eventvar",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "currentHP",
                                "comparison": 3,
                                "value": "0"
                            }
                        },
                        {
                            "id": "trigger-once-while-true",
                            "objectClass": "System"
                        }
                    ],
                    "actions": [
                        {
                            "id": "tween-one-property",
                            "objectClass": "PlayerCombat",
                            "behaviorType": "Tween",
                            "parameters": {
                                "tags": "\"PlayerDies\"",
                                "property": "offsetOpacity",
                                "end-value": "0",
                                "time": "1",
                                "ease": "easeinoutsine",
                                "destroy-on-complete": "no",
                                "loop": "no",
                                "ping-pong": "no",
                                "repeat-count": "1"
                            }
                        },
                        {
                            "id": "set-animation",
                            "objectClass": "PlayerCombat",
                            "parameters": {
                                "animation": "\"GroundImpact\"",
                                "from": "beginning"
                            }
                        },
                        {
                            "id": "set-eventvar-value",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "combatState",
                                "value": "\"defeat\""
                            }
                        },
                        {
                            "id": "play",
                            "objectClass": "Audio",
                            "parameters": {
                                "audio-file": "Enemy_Destroy",
                                "loop": "not-looping",
                                "volume": "0",
                                "stereo-pan": "0",
                                "tag-optional": "\"Die\""
                            }
                        },
                        {
                            "id": "fade-volume",
                            "objectClass": "Audio",
                            "parameters": {
                                "tag": "\"Battle\"",
                                "db": "-100",
                                "duration": "0",
                                "ending": "stop"
                            }
                        },
                        {
                            "type": "script",
                            "language": "javascript",
                            "script": [
                                "console.log('💀 DERROTA - ¡Jugador derrotado! EnemyHP final:')"
                            ]
                        }
                    ],
                    "children": [
                        {
                            "eventType": "block",
                            "conditions": [
                                {
                                    "id": "on-tweens-finished",
                                    "objectClass": "PlayerCombat",
                                    "behaviorType": "Tween",
                                    "parameters": {
                                        "tags": "\"PlayerDies\""
                                    }
                                }
                            ],
                            "actions": [
                                {
                                    "id": "destroy",
                                    "objectClass": "PlayerCombat"
                                }
                            ]
                        }
                    ]
                },
                {
                    "functionName": "damageText",
                    "functionDescription": "",
                    "functionCategory": "",
                    "functionReturnType": "none",
                    "functionCopyPicked": false,
                    "functionIsAsync": false,
                    "functionParameters": [
                        {
                            "name": "texto",
                            "type": "string",
                            "initialValue": "",
                            "comment": ""
                        }
                    ],
                    "eventType": "function-block",
                    "conditions": [],
                    "actions": [
                        {
                            "id": "set-position",
                            "objectClass": "Damage",
                            "parameters": {
                                "x": "PlayerCombat.X",
                                "y": "PlayerCombat.Y - 300"
                            }
                        },
                        {
                            "id": "set-text",
                            "objectClass": "Damage",
                            "parameters": {
                                "text": "texto"
                            }
                        },
                        {
                            "id": "set-visible",
                            "objectClass": "Damage",
                            "parameters": {
                                "visibility": "visible"
                            }
                        },
                        {
                            "id": "tween-two-properties",
                            "objectClass": "Damage",
                            "behaviorType": "Tween",
                            "parameters": {
                                "tags": "\"DamageFloat\"",
                                "property": "position",
                                "end-x": "Damage.X",
                                "end-y": "Damage.Y - 300",
                                "time": "1.5",
                                "ease": "easeinsine",
                                "destroy-on-complete": "no",
                                "loop": "no",
                                "ping-pong": "no",
                                "repeat-count": "1"
                            }
                        },
                        {
                            "id": "tween-value",
                            "objectClass": "Damage",
                            "behaviorType": "Tween",
                            "parameters": {
                                "tags": "\"DamageFade\"",
                                "start-value": "255",
                                "end-value": "0",
                                "time": "1.5",
                                "ease": "easeinoutsine",
                                "destroy-on-complete": "no",
                                "loop": "no",
                                "ping-pong": "no",
                                "repeat-count": "1"
                            }
                        }
                    ]
                },
                {
                    "functionName": "playerHit",
                    "functionDescription": "",
                    "functionCategory": "",
                    "functionReturnType": "none",
                    "functionCopyPicked": false,
                    "functionIsAsync": false,
                    "functionParameters": [
                        {
                            "name": "character",
                            "type": "string",
                            "initialValue": "",
                            "comment": ""
                        }
                    ],
                    "eventType": "function-block",
                    "conditions": [],
                    "actions": [
                        {
                            "type": "comment",
                            "text": "Funcion para aplicar daño al personaje"
                        }
                    ],
                    "children": [
                        {
                            "eventType": "block",
                            "conditions": [
                                {
                                    "id": "compare-eventvar",
                                    "objectClass": "System",
                                    "parameters": {
                                        "variable": "character",
                                        "comparison": 0,
                                        "value": "\"Player\""
                                    }
                                }
                            ],
                            "actions": [
                                {
                                    "id": "set-boolean-eventvar",
                                    "objectClass": "System",
                                    "parameters": {
                                        "variable": "playerDodged",
                                        "value": "false"
                                    }
                                },
                                {
                                    "id": "set-animation",
                                    "objectClass": "PlayerCombat",
                                    "parameters": {
                                        "animation": "\"Injured\"",
                                        "from": "beginning"
                                    }
                                },
                                {
                                    "id": "tween-value",
                                    "objectClass": "PlayerCombat",
                                    "behaviorType": "Tween",
                                    "parameters": {
                                        "tags": "\"PlayerFlash\"",
                                        "start-value": "200",
                                        "end-value": "100",
                                        "time": "flashAnimationTime",
                                        "ease": "easeoutsine",
                                        "destroy-on-complete": "no",
                                        "loop": "no",
                                        "ping-pong": "no",
                                        "repeat-count": "1"
                                    }
                                },
                                {
                                    "id": "play",
                                    "objectClass": "Audio",
                                    "parameters": {
                                        "audio-file": "Player_Hurt",
                                        "loop": "not-looping",
                                        "volume": "0",
                                        "stereo-pan": "0",
                                        "tag-optional": "\"EnemyAttack\""
                                    }
                                },
                                {
                                    "id": "subtract-from-eventvar",
                                    "objectClass": "System",
                                    "parameters": {
                                        "variable": "currentHP",
                                        "value": "max(1, (isEnemyCriticalHit ? EnemyCombat.PhysicalDamage * (1 + EnemyCombat.CriticalDamage / 100) : EnemyCombat.PhysicalDamage) - PlayerCombat.DamageReduction)"
                                    }
                                },
                                {
                                    "id": "set-eventvar-value",
                                    "objectClass": "System",
                                    "parameters": {
                                        "variable": "currentHP",
                                        "value": "max(0, currentHP)"
                                    }
                                },
                                {
                                    "id": "set-text",
                                    "objectClass": "PlayerHealth",
                                    "parameters": {
                                        "text": "\"HP: \" & round(max(0, currentHP))"
                                    }
                                },
                                {
                                    "id": "tween-value",
                                    "objectClass": "PlayerHealthBar",
                                    "behaviorType": "Tween",
                                    "parameters": {
                                        "tags": "\"PlayerHealthBarTween\"",
                                        "start-value": "PlayerHealthBar.width",
                                        "end-value": "PlayerHealthBar.Width* (max(0, currentHP) / max(1, PlayerCombat.MaxHealth))",
                                        "time": "0.5",
                                        "ease": "easeoutsine",
                                        "destroy-on-complete": "no",
                                        "loop": "no",
                                        "ping-pong": "no",
                                        "repeat-count": "1"
                                    }
                                },
                                {
                                    "id": "set-eventvar-value",
                                    "objectClass": "System",
                                    "parameters": {
                                        "variable": "combatState",
                                        "value": "\"enemyReturning\""
                                    }
                                }
                            ]
                        },
                        {
                            "eventType": "block",
                            "conditions": [
                                {
                                    "id": "compare-eventvar",
                                    "objectClass": "System",
                                    "parameters": {
                                        "variable": "character",
                                        "comparison": 0,
                                        "value": "\"Enemy\""
                                    }
                                }
                            ],
                            "actions": [
                                {
                                    "id": "set-boolean-eventvar",
                                    "objectClass": "System",
                                    "parameters": {
                                        "variable": "enemyDodge",
                                        "value": "false"
                                    }
                                },
                                {
                                    "id": "set-animation",
                                    "objectClass": "EnemyCombat",
                                    "parameters": {
                                        "animation": "\"Injured\"",
                                        "from": "beginning"
                                    }
                                },
                                {
                                    "id": "tween-value",
                                    "objectClass": "EnemyCombat",
                                    "behaviorType": "Tween",
                                    "parameters": {
                                        "tags": "\"EnemyFlash\"",
                                        "start-value": "200",
                                        "end-value": "100",
                                        "time": "flashAnimationTime",
                                        "ease": "easeoutsine",
                                        "destroy-on-complete": "no",
                                        "loop": "no",
                                        "ping-pong": "no",
                                        "repeat-count": "1"
                                    }
                                },
                                {
                                    "id": "play",
                                    "objectClass": "Audio",
                                    "parameters": {
                                        "audio-file": "Player_Sword_1",
                                        "loop": "not-looping",
                                        "volume": "0",
                                        "stereo-pan": "0",
                                        "tag-optional": "\"PlayerAttack\""
                                    }
                                },
                                {
                                    "id": "subtract-from-eventvar",
                                    "objectClass": "System",
                                    "parameters": {
                                        "variable": "currentEnemyHP",
                                        "value": "max(1, (isCriticalHit ? PlayerCombat.PhysicalDamage * (1 + PlayerCombat.CriticalDamage / 100) : PlayerCombat.PhysicalDamage) - EnemyCombat.DamageReduction)"
                                    }
                                },
                                {
                                    "id": "set-text",
                                    "objectClass": "EnemyHealth",
                                    "parameters": {
                                        "text": "\"HP: \" & round(max(0, currentEnemyHP))"
                                    }
                                },
                                {
                                    "id": "tween-value",
                                    "objectClass": "EnemyHealthBar",
                                    "behaviorType": "Tween",
                                    "parameters": {
                                        "tags": "\"EnemyHealthBarTween\"",
                                        "start-value": "EnemyHealthBar.width",
                                        "end-value": "EnemyHealthBar.Width* (max(0, currentEnemyHP) / max(1, EnemyCombat.MaxHealth))",
                                        "time": "0.5",
                                        "ease": "easeoutsine",
                                        "destroy-on-complete": "no",
                                        "loop": "no",
                                        "ping-pong": "no",
                                        "repeat-count": "1"
                                    }
                                },
                                {
                                    "id": "set-eventvar-value",
                                    "objectClass": "System",
                                    "parameters": {
                                        "variable": "combatState",
                                        "value": "\"playerReturning\""
                                    }
                                }
                            ]
                        }
                    ]
                },
                {
                    "functionName": "Dodge",
                    "functionDescription": "",
                    "functionCategory": "",
                    "functionReturnType": "none",
                    "functionCopyPicked": false,
                    "functionIsAsync": false,
                    "functionParameters": [
                        {
                            "name": "character",
                            "type": "string",
                            "initialValue": "",
                            "comment": ""
                        }
                    ],
                    "eventType": "function-block",
                    "conditions": [],
                    "actions": [
                        {
                            "type": "comment",
                            "text": "Aplica la esquiva"
                        }
                    ],
                    "children": [
                        {
                            "eventType": "block",
                            "conditions": [
                                {
                                    "id": "compare-eventvar",
                                    "objectClass": "System",
                                    "parameters": {
                                        "variable": "character",
                                        "comparison": 0,
                                        "value": "\"Player\""
                                    }
                                }
                            ],
                            "actions": [
                                {
                                    "id": "set-boolean-eventvar",
                                    "objectClass": "System",
                                    "parameters": {
                                        "variable": "playerDodged",
                                        "value": "true"
                                    }
                                },
                                {
                                    "id": "set-animation",
                                    "objectClass": "PlayerCombat",
                                    "parameters": {
                                        "animation": "\"Dodge\"",
                                        "from": "beginning"
                                    }
                                },
                                {
                                    "id": "play",
                                    "objectClass": "Audio",
                                    "parameters": {
                                        "audio-file": "Player_Dash",
                                        "loop": "not-looping",
                                        "volume": "0",
                                        "stereo-pan": "0",
                                        "tag-optional": "\"Dash\""
                                    }
                                }
                            ]
                        },
                        {
                            "eventType": "block",
                            "conditions": [
                                {
                                    "id": "compare-eventvar",
                                    "objectClass": "System",
                                    "parameters": {
                                        "variable": "character",
                                        "comparison": 0,
                                        "value": "\"Enemy\""
                                    }
                                }
                            ],
                            "actions": [
                                {
                                    "id": "set-boolean-eventvar",
                                    "objectClass": "System",
                                    "parameters": {
                                        "variable": "enemyDodge",
                                        "value": "true"
                                    }
                                },
                                {
                                    "id": "set-animation",
                                    "objectClass": "EnemyCombat",
                                    "parameters": {
                                        "animation": "\"Dodge\"",
                                        "from": "beginning"
                                    }
                                },
                                {
                                    "id": "play",
                                    "objectClass": "Audio",
                                    "parameters": {
                                        "audio-file": "Player_Dash",
                                        "loop": "not-looping",
                                        "volume": "0",
                                        "stereo-pan": "0",
                                        "tag-optional": "\"Dash\""
                                    }
                                }
                            ]
                        }
                    ]
                }
            ]
        }
    ]
}