{
    "is-c3-clipboard-data": true,
    "type": "events",
    "items": [
        {
            "eventType": "include",
            "includeSheet": "GlobalVariables"
        },
        {
            "eventType": "group",
            "disabled": false,
            "title": "Combat System - Optimizado",
            "description": "Sistema de combate automático optimizado entre PlayerCombat y EnemyCombat",
            "isActiveOnStart": true,
            "children": [
                {
                    "eventType": "comment",
                    "text": "=== INICIALIZACIÓN DEL SISTEMA ==="
                },
                {
                    "eventType": "block",
                    "conditions": [
                        {
                            "id": "on-start-of-layout",
                            "objectClass": "System"
                        }
                    ],
                    "actions": [
                        {
                            "id": "set-eventvar-value",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "combatState",
                                "value": "\"playerTurn\""
                            }
                        },
                        {
                            "id": "set-instvar-value",
                            "objectClass": "PlayerCombat",
                            "parameters": {
                                "instance-variable": "PhysicalDamage",
                                "value": "PlayerCombat.Strength * 3 + PlayerCombat.Agility * 1"
                            }
                        },
                        {
                            "id": "set-instvar-value",
                            "objectClass": "PlayerCombat",
                            "parameters": {
                                "instance-variable": "MaxHealth",
                                "value": "PlayerCombat.Vitality * 20 + PlayerCombat.Strength * 5"
                            }
                        },
                        {
                            "id": "set-instvar-value",
                            "objectClass": "PlayerCombat",
                            "parameters": {
                                "instance-variable": "DodgeChance",
                                "value": "PlayerCombat.Agility * 1.5 + PlayerCombat.Speed * 0.8"
                            }
                        },
                        {
                            "id": "set-instvar-value",
                            "objectClass": "EnemyCombat",
                            "parameters": {
                                "instance-variable": "PhysicalDamage",
                                "value": "EnemyCombat.Strength * 3 + EnemyCombat.Agility * 1"
                            }
                        },
                        {
                            "id": "set-instvar-value",
                            "objectClass": "EnemyCombat",
                            "parameters": {
                                "instance-variable": "MaxHealth",
                                "value": "EnemyCombat.Vitality * 20 + EnemyCombat.Strength * 5"
                            }
                        },
                        {
                            "id": "set-eventvar-value",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "currentHP",
                                "value": "PlayerCombat.MaxHealth"
                            }
                        },
                        {
                            "id": "set-eventvar-value",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "currentEnemyHP",
                                "value": "EnemyCombat.MaxHealth"
                            }
                        },
                        {
                            "id": "set-eventvar-value",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "originalPlayerX",
                                "value": "PlayerCombat.X"
                            }
                        },
                        {
                            "id": "set-eventvar-value",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "originalPlayerY",
                                "value": "PlayerCombat.Y"
                            }
                        },
                        {
                            "id": "set-eventvar-value",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "originalEnemyX",
                                "value": "EnemyCombat.X"
                            }
                        },
                        {
                            "id": "set-eventvar-value",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "originalEnemyY",
                                "value": "EnemyCombat.Y"
                            }
                        },
                        {
                            "id": "set-text",
                            "objectClass": "PlayerHealth",
                            "parameters": {
                                "text": "\"HP: \" & currentHP"
                            }
                        },
                        {
                            "id": "set-text",
                            "objectClass": "EnemyHealth",
                            "parameters": {
                                "text": "\"HP: \" & currentEnemyHP"
                            }
                        }
                    ]
                },
                {
                    "eventType": "comment",
                    "text": "=== SISTEMA DE COOLDOWN ==="
                },
                {
                    "eventType": "block",
                    "conditions": [
                        {
                            "id": "every-tick",
                            "objectClass": "System"
                        },
                        {
                            "id": "compare-eventvar",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "attackCooldown",
                                "comparison": 1,
                                "value": "0"
                            }
                        }
                    ],
                    "actions": [
                        {
                            "id": "subtract-from-eventvar",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "attackCooldown",
                                "value": "1"
                            }
                        }
                    ]
                },
                {
                    "eventType": "block",
                    "conditions": [
                        {
                            "id": "compare-eventvar",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "attackCooldown",
                                "comparison": 0,
                                "value": "0"
                            }
                        },
                        {
                            "id": "compare-boolean-eventvar",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "isAttacking"
                            },
                            "isInverted": true
                        }
                    ],
                    "actions": [
                        {
                            "id": "set-eventvar-value",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "attackCooldown",
                                "value": "120"
                            }
                        },
                        {
                            "id": "set-boolean-eventvar",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "isAttacking",
                                "value": "true"
                            }
                        }
                    ]
                },
                {
                    "eventType": "comment",
                    "text": "=== SISTEMA DE TURNOS ==="
                },
                {
                    "eventType": "block",
                    "conditions": [
                        {
                            "id": "compare-eventvar",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "combatState",
                                "comparison": 0,
                                "value": "\"playerTurn\""
                            }
                        },
                        {
                            "id": "compare-boolean-eventvar",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "isAttacking"
                            }
                        }
                    ],
                    "actions": [
                        {
                            "id": "set-eventvar-value",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "combatState",
                                "value": "\"playerAttacking\""
                            }
                        },
                        {
                            "id": "set-eventvar-value",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "targetX",
                                "value": "EnemyCombat.X"
                            }
                        },
                        {
                            "id": "set-eventvar-value",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "targetY",
                                "value": "EnemyCombat.Y"
                            }
                        }
                    ]
                },
                {
                    "eventType": "block",
                    "conditions": [
                        {
                            "id": "compare-eventvar",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "combatState",
                                "comparison": 0,
                                "value": "\"enemyTurn\""
                            }
                        },
                        {
                            "id": "compare-boolean-eventvar",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "isAttacking"
                            }
                        }
                    ],
                    "actions": [
                        {
                            "id": "set-eventvar-value",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "combatState",
                                "value": "\"enemyAttacking\""
                            }
                        },
                        {
                            "id": "set-eventvar-value",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "targetX",
                                "value": "PlayerCombat.X"
                            }
                        },
                        {
                            "id": "set-eventvar-value",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "targetY",
                                "value": "PlayerCombat.Y"
                            }
                        }
                    ]
                },
                {
                    "eventType": "comment",
                    "text": "=== SISTEMA DE MOVIMIENTO ==="
                },
                {
                    "eventType": "block",
                    "conditions": [
                        {
                            "id": "every-tick",
                            "objectClass": "System"
                        },
                        {
                            "id": "compare-eventvar",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "combatState",
                                "comparison": 0,
                                "value": "\"playerAttacking\""
                            }
                        }
                    ],
                    "actions": [
                        {
                            "id": "set-position",
                            "objectClass": "PlayerCombat",
                            "parameters": {
                                "x": "PlayerCombat.X + (targetX - PlayerCombat.X) * 0.1",
                                "y": "PlayerCombat.Y + (targetY - PlayerCombat.Y) * 0.1"
                            }
                        }
                    ]
                },
                {
                    "eventType": "block",
                    "conditions": [
                        {
                            "id": "every-tick",
                            "objectClass": "System"
                        },
                        {
                            "id": "compare-eventvar",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "combatState",
                                "comparison": 0,
                                "value": "\"enemyAttacking\""
                            }
                        }
                    ],
                    "actions": [
                        {
                            "id": "set-position",
                            "objectClass": "EnemyCombat",
                            "parameters": {
                                "x": "EnemyCombat.X + (targetX - EnemyCombat.X) * 0.1",
                                "y": "EnemyCombat.Y + (targetY - EnemyCombat.Y) * 0.1"
                            }
                        }
                    ]
                },
                {
                    "eventType": "comment",
                    "text": "=== SISTEMA DE ATAQUE ==="
                },
                {
                    "eventType": "block",
                    "conditions": [
                        {
                            "id": "compare-eventvar",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "combatState",
                                "comparison": 0,
                                "value": "\"playerAttacking\""
                            }
                        },
                        {
                            "id": "compare-two-values",
                            "objectClass": "System",
                            "parameters": {
                                "first-value": "distance(PlayerCombat.X, PlayerCombat.Y, targetX, targetY)",
                                "comparison": 2,
                                "second-value": "50"
                            }
                        }
                    ],
                    "actions": [
                        {
                            "id": "subtract-from-eventvar",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "currentEnemyHP",
                                "value": "PlayerCombat.PhysicalDamage"
                            }
                        },
                        {
                            "id": "set-eventvar-value",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "currentEnemyHP",
                                "value": "max(0, currentEnemyHP)"
                            }
                        },
                        {
                            "id": "set-text",
                            "objectClass": "EnemyHealth",
                            "parameters": {
                                "text": "\"HP: \" & currentEnemyHP"
                            }
                        },
                        {
                            "id": "set-eventvar-value",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "combatState",
                                "value": "\"enemyTurn\""
                            }
                        },
                        {
                            "id": "set-boolean-eventvar",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "isAttacking",
                                "value": "false"
                            }
                        }
                    ]
                },
                {
                    "eventType": "comment",
                    "text": "=== SISTEMA DE ESQUIVA DEL JUGADOR ==="
                },
                {
                    "eventType": "block",
                    "conditions": [
                        {
                            "id": "compare-eventvar",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "combatState",
                                "comparison": 0,
                                "value": "\"enemyAttacking\""
                            }
                        },
                        {
                            "id": "compare-two-values",
                            "objectClass": "System",
                            "parameters": {
                                "first-value": "distance(EnemyCombat.X, EnemyCombat.Y, targetX, targetY)",
                                "comparison": 2,
                                "second-value": "50"
                            }
                        }
                    ],
                    "actions": [
                        {
                            "id": "set-eventvar-value",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "randomDodgeValue",
                                "value": "random(0, 100)"
                            }
                        },
                        {
                            "id": "set-boolean-eventvar",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "playerDodged",
                                "value": "randomDodgeValue <= PlayerCombat.DodgeChance"
                            }
                        }
                    ]
                },
                {
                    "eventType": "block",
                    "conditions": [
                        {
                            "id": "compare-eventvar",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "combatState",
                                "comparison": 0,
                                "value": "\"enemyAttacking\""
                            }
                        },
                        {
                            "id": "compare-boolean-eventvar",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "playerDodged"
                            }
                        }
                    ],
                    "actions": [
                        {
                            "id": "set-text",
                            "objectClass": "Damage",
                            "parameters": {
                                "text": "\"ESQUIVADO!\""
                            }
                        },
                        {
                            "id": "set-position",
                            "objectClass": "Damage",
                            "parameters": {
                                "x": "PlayerCombat.X",
                                "y": "PlayerCombat.Y - 100"
                            }
                        },
                        {
                            "id": "set-visible",
                            "objectClass": "Damage",
                            "parameters": {
                                "visibility": "visible"
                            }
                        }
                    ]
                },
                {
                    "eventType": "block",
                    "conditions": [
                        {
                            "id": "compare-eventvar",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "combatState",
                                "comparison": 0,
                                "value": "\"enemyAttacking\""
                            }
                        },
                        {
                            "id": "compare-boolean-eventvar",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "playerDodged"
                            },
                            "isInverted": true
                        }
                    ],
                    "actions": [
                        {
                            "id": "subtract-from-eventvar",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "currentHP",
                                "value": "enemyAttack"
                            }
                        },
                        {
                            "id": "set-eventvar-value",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "currentHP",
                                "value": "max(0, currentHP)"
                            }
                        },
                        {
                            "id": "set-text",
                            "objectClass": "PlayerHealth",
                            "parameters": {
                                "text": "\"HP: \" & currentHP"
                            }
                        },
                        {
                            "id": "set-text",
                            "objectClass": "Damage",
                            "parameters": {
                                "text": "\"-\" & enemyAttack"
                            }
                        },
                        {
                            "id": "set-position",
                            "objectClass": "Damage",
                            "parameters": {
                                "x": "PlayerCombat.X",
                                "y": "PlayerCombat.Y - 100"
                            }
                        },
                        {
                            "id": "set-visible",
                            "objectClass": "Damage",
                            "parameters": {
                                "visibility": "visible"
                            }
                        }
                    ]
                },
                {
                    "eventType": "block",
                    "conditions": [
                        {
                            "id": "compare-eventvar",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "combatState",
                                "comparison": 0,
                                "value": "\"enemyAttacking\""
                            }
                        }
                    ],
                    "actions": [
                        {
                            "id": "set-eventvar-value",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "combatState",
                                "value": "\"playerTurn\""
                            }
                        },
                        {
                            "id": "set-boolean-eventvar",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "isAttacking",
                                "value": "false"
                            }
                        }
                    ]
                },
                {
                    "eventType": "comment",
                    "text": "=== SISTEMA DE FINALIZACIÓN ==="
                },
                {
                    "eventType": "block",
                    "conditions": [
                        {
                            "id": "compare-eventvar",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "currentEnemyHP",
                                "comparison": 3,
                                "value": "0"
                            }
                        }
                    ],
                    "actions": [
                        {
                            "id": "set-eventvar-value",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "combatState",
                                "value": "\"victory\""
                            }
                        }
                    ]
                },
                {
                    "eventType": "block",
                    "conditions": [
                        {
                            "id": "compare-eventvar",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "currentHP",
                                "comparison": 3,
                                "value": "0"
                            }
                        }
                    ],
                    "actions": [
                        {
                            "id": "set-eventvar-value",
                            "objectClass": "System",
                            "parameters": {
                                "variable": "combatState",
                                "value": "\"defeat\""
                            }
                        }
                    ]
                }
            ]
        }
    ]
}